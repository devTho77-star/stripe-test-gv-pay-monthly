<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monthly Donation Form</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    * {box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;}
    body {background: #f8f9fa; color: #212529; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; line-height: 1.6;}
    .container {width: 100%; max-width: 800px; background: white; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden;}
    .header {background: #2c3e50; color: white; padding: 24px 32px; display: flex; align-items: center;}
    .logo {width: 48px; height: 48px; background: white; border-radius: 12px; display: flex; justify-content: center; align-items: center; margin-right: 16px;}
    .logo i {font-size: 24px; color: #2c3e50;}
    .header-content h1 {font-size: 24px; font-weight: 600; margin-bottom: 4px;}
    .header-content p {opacity: 0.9; font-size: 14px;}
    .payment-body {padding: 32px;}
    .section-title {font-size: 18px; color: #2c3e50; margin: 28px 0 18px; padding-bottom: 12px; border-bottom: 1px solid #e9ecef; display: flex; align-items: center; font-weight: 600;}
    .section-title i {margin-right: 12px;}
    .donation-amounts {display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 16px;}
    .donation-amounts .donation-option {flex: 1 1 30%; background: #f8f9fa; border: 1px solid #ced4da; border-radius: 8px; padding: 16px; text-align: center; cursor: pointer; transition: all 0.3s ease; font-weight: 500;}
    .donation-amounts .donation-option.active {background: #2c3e50; color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(0,0,0,0.1);}
    .other-amount-container {display: none; margin-top: 16px;}
    .other-amount-container.visible {display: block;}
    .currency-symbol {position: relative;}
    .currency-symbol::before {content: "€"; position: absolute; left: 16px; top: 16px; color: #495057; font-weight: 500; z-index: 1;}
    .currency-symbol input {padding-left: 38px;}
    .form-group {margin-bottom: 24px;}
    label {display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px; color: #495057;}
    input, select {width: 100%; padding: 16px; border: 1px solid #ced4da; border-radius: 8px; font-size: 16px; transition: all 0.2s ease; color: #212529; background: white;}
    input:focus, select:focus {outline: none; border-color: #2c3e50; box-shadow: 0 0 0 3px rgba(44,62,80,0.1);}
    .form-row {display: flex; gap: 20px; margin-bottom: 20px;}
    .form-row .form-group {flex: 1; margin-bottom: 0;}
    .card-element-container {padding: 16px; border: 1px solid #ced4da; border-radius: 8px; background: white;}
    .StripeElement--focus {box-shadow: 0 0 0 3px rgba(44,62,80,0.1); border-color: #2c3e50;}
    .pay-button {background: #2c3e50; color: white; border: none; border-radius: 8px; padding: 18px; font-size: 16px; font-weight: 600; width: 100%; cursor: pointer; transition: all 0.3s ease; margin-top: 10px;}
    .pay-button:hover {background: #1a252f;}
    .pay-button:disabled {opacity: 0.7; cursor: not-allowed;}
    .secure-notice {display: flex; align-items: center; justify-content: center; margin-top: 24px; color: #6c757d; font-size: 14px;}
    .secure-notice i {margin-right: 8px; color: #28a745;}
    .accepted-cards {margin-top: 28px; text-align: center;}
    .accepted-cards p {font-size: 14px; color: #6c757d; margin-bottom: 12px;}
    .card-icons {display: flex; justify-content: center; gap: 12px;}
    .card-icons i {font-size: 32px; color: #495057;}
    .payment-footer {background: #f8f9fa; padding: 20px 32px; text-align: center; border-top: 1px solid #e9ecef;}
    .payment-footer p {font-size: 14px; color: #6c757d;}
    #donation-by {font-style: italic;}
    #donation-by::placeholder {font-style: italic; color: #6c757d;}
    .card-errors {color: #dc3545; margin-top: 8px; font-size: 14px;}
    .subscription-badge {background: #3498db; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; margin-left: 10px;}
    .monthly-notice {background: #e8f4fd; border-radius: 8px; padding: 16px; margin-bottom: 24px; text-align: center; border-left: 4px solid #3498db;}
    .monthly-notice i {color: #3498db; margin-right: 8px;}
  </style>
</head>
<body>
<div class="container">
  <form id="payment-form">
    <div class="header">
      <div class="logo"><i class="fas fa-calendar-check"></i></div>
      <div class="header-content">
        <h1>Monthly Donation Plan</h1>
        <p>Set up a recurring monthly contribution</p>
      </div>
    </div>

    <div class="payment-body">
      <div class="monthly-notice">
        <i class="fas fa-info-circle"></i>
        <span>You're setting up a <strong>monthly recurring donation</strong> that will continue until you cancel.</span>
      </div>
      
      <div class="section-title"><i class="fas fa-money-bill-wave"></i><span>Monthly Donation Amount</span></div>
      
      <div class="donation-amounts">
        <div class="donation-option active" data-value="10">€10/month</div>
        <div class="donation-option" data-value="25">€25/month</div>
        <div class="donation-option" data-value="50">€50/month</div>
        <div class="donation-option" data-value="100">€100/month</div>
        <div class="donation-option" data-value="other">Other amount</div>
      </div>

      <div class="other-amount-container" id="other-amount-container">
        <div class="form-group currency-symbol">
          <label for="custom-amount">Enter Custom Monthly Amount (€)</label>
          <input type="number" id="custom-amount" placeholder="Enter amount" min="1" step="0.01">
        </div>
      </div>

      <div class="form-group">
        <label for="donation-by">Make donation by the name of (Optional)</label>
        <input type="text" id="donation-by" placeholder="e.g., In memory of John Doe, Company Name, etc.">
      </div>

      <div class="section-title"><i class="fas fa-user"></i><span>Personal Information</span></div>
      <div class="form-group"><label for="name">Full Name</label><input type="text" id="name" placeholder="John Smith" required></div>
      <div class="form-group"><label for="email">Email Address</label><input type="email" id="email" placeholder="your.email@example.com" required></div>
      <div class="form-group"><label for="phone">Phone Number (Optional)</label><input type="tel" id="phone" placeholder="(123) 456-7890"></div>

      <div class="section-title"><i class="fas fa-address-card"></i><span>Billing Address</span></div>
      <div class="form-group"><label for="line1">Street Address</label><input type="text" id="line1" placeholder="123 Main St" required></div>
      <div class="form-group"><label for="line2">Apt, Suite, Building (Optional)</label><input type="text" id="line2" placeholder="Apt 456"></div>

      <div class="form-row">
        <div class="form-group"><label for="city">City</label><input type="text" id="city" placeholder="Paris" required></div>
        <div class="form-group"><label for="state">State/Province</label><input type="text" id="state" placeholder="Île-de-France"></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label for="postal_code">Postal Code</label><input type="text" id="postal_code" placeholder="75001" required></div>
        <div class="form-group"><label for="country">Country</label>
          <select id="country" required>
            <option value="">Select country</option>
            <option value="FR" selected>France</option>
            <option value="DE">Germany</option>
            <option value="IT">Italy</option>
            <option value="ES">Spain</option>
          </select>
        </div>
      </div>

      <div class="section-title"><i class="fas fa-credit-card"></i><span>Payment Information</span></div>
      <div class="form-group"><label for="card-element">Card Details</label>
        <div class="card-element-container" id="card-element"></div>
        <div class="card-errors" id="card-errors" role="alert"></div>
      </div>
      <div class="form-group"><label for="card-name">Name on Card</label><input type="text" id="card-name" placeholder="John Smith" required></div>

      <button class="pay-button" id="submit-button" type="submit">Start Monthly Donation of €10</button>

      <div class="secure-notice"><i class="fas fa-lock"></i><span>Your payment is secured with SSL encryption</span></div>
      <div class="accepted-cards">
        <p>We accept</p>
        <div class="card-icons">
          <i class="fa-brands fa-cc-visa"></i>
          <i class="fa-brands fa-cc-mastercard"></i>
          <i class="fa-brands fa-cc-amex"></i>
          <i class="fa-brands fa-cc-discover"></i>
        </div>
      </div>
    </div>

    <div class="payment-footer">
      <p>Your donation will recur monthly until canceled. You can manage your subscription anytime.</p>
      <p>© 2023 Your Organization. All rights reserved.</p>
    </div>
  </form>
</div>

<script>
// Initialize Stripe
const stripe = Stripe('pk_test_51S1OAH3pBglTeA0mBud6ByC3NIv6nMTrQ4ITBQ1h1GDTBX5ygMuoeCVeBZdF1Jy5wmQq819Xbd4kKRjZ3aJJcDfu00dGiF5MC6');
const elements = stripe.elements();
const style = {
  base: {
    color: '#212529',
    fontFamily: '"Inter", "Segoe UI", system-ui, sans-serif',
    fontSmoothing: 'antialiased',
    fontSize: '16px',
    '::placeholder': { color: '#6c757d' }
  },
  invalid: { color: '#dc3545', iconColor: '#dc3545' }
};

// Create card element
const card = elements.create('card', { style: style, hidePostalCode: true });
card.mount('#card-element');

// Handle form elements
const donationOptions = document.querySelectorAll('.donation-amounts .donation-option');
const otherAmountContainer = document.getElementById('other-amount-container');
const customAmountInput = document.getElementById('custom-amount');
const payButton = document.getElementById('submit-button');
const form = document.getElementById('payment-form');
const cardErrors = document.getElementById('card-errors');

// Handle donation amount selection
donationOptions.forEach(option => {
  option.addEventListener('click', function() {
    donationOptions.forEach(opt => opt.classList.remove('active'));
    this.classList.add('active');
    if (this.dataset.value === 'other') {
      otherAmountContainer.classList.add('visible');
      customAmountInput.focus();
    } else {
      otherAmountContainer.classList.remove('visible');
    }
    updateButtonText();
  });
});

// Update button text when custom amount changes
customAmountInput.addEventListener('input', updateButtonText);

// Get the selected amount
function getSelectedAmount() {
  const activeOption = document.querySelector('.donation-amounts .donation-option.active');
  if (activeOption.dataset.value === 'other') {
    return parseFloat(customAmountInput.value) || 0;
  } else {
    return parseFloat(activeOption.dataset.value);
  }
}

// Update the pay button text
function updateButtonText() {
  const amount = getSelectedAmount();
  
  if (amount > 0) {
    payButton.textContent = `Start Monthly Donation of €${amount}`;
  } else if (document.querySelector('.donation-amounts .donation-option.active').dataset.value === 'other') {
    payButton.textContent = 'Enter amount';
  }
}

// Display card errors
card.addEventListener('change', function(event) {
  cardErrors.textContent = event.error ? event.error.message : '';
});

// Handle form submission
form.addEventListener('submit', async (event) => {
  event.preventDefault();

  const amount = getSelectedAmount();
  if (amount <= 0) {
    alert('Please enter a valid amount');
    return;
  }

  cardErrors.textContent = '';
  payButton.disabled = true;
  payButton.textContent = 'Setting up...';

  try {
    const donationByName = document.getElementById('donation-by').value;
    
    // For a real implementation, you would create a subscription on your server
    // This is a mock implementation for demonstration
    const response = await fetch('/.netlify/functions/create-subscription', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        amount: Math.round(amount * 100), // cents
        currency: 'eur',
        interval: 'monthly',
        donation_by: donationByName
      }),
    });

    const data = await response.json();
    if (!response.ok) throw new Error(data.error || 'Failed to create subscription');

    // In a real implementation, you would use stripe.confirmCardSetup for subscriptions
    // This is simplified for demonstration
    const { error, paymentIntent } = await stripe.confirmCardPayment(data.clientSecret, {
      payment_method: {
        card: card,
        billing_details: {
          name: document.getElementById('card-name').value,
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value,
          address: {
            line1: document.getElementById('line1').value,
            line2: document.getElementById('line2').value,
            city: document.getElementById('city').value,
            state: document.getElementById('state').value,
            postal_code: document.getElementById('postal_code').value,
            country: document.getElementById('country').value,
          }
        }
      }
    });

    if (error) {
      cardErrors.textContent = error.message;
      payButton.disabled = false;
      updateButtonText();
    } else {
      alert(`Monthly subscription setup successful! Thank you for your ongoing support.` + 
        (donationByName ? ` Your donation is made in the name of: ${donationByName}` : ''));
      form.reset();
      donationOptions.forEach(opt => opt.classList.remove('active'));
      donationOptions[0].classList.add('active');
      otherAmountContainer.classList.remove('visible');
      updateButtonText();
    }
  } catch (err) {
    console.error('Error:', err);
    cardErrors.textContent = err.message;
    payButton.disabled = false;
    updateButtonText();
  }
});

// Initialize button text
updateButtonText();
</script>
</body>
</html>
